<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Credit Snapshot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

    <h1>Verify Credit Snapshot</h1>
    <p>Look up credit snapshots by wallet address or token ID.</p>

    <form id="verifyForm">
        <label for="wallet_address">Wallet Address:</label>
        <input type="text" id="wallet_address" name="wallet_address" placeholder="0x...">

        <label for="token_id">Or Token ID:</label>
        <input type="number" id="token_id" name="token_id" placeholder="0">

        <button type="submit">Verify</button>
    </form>

    <div id="verifyResult"></div>

    <script>
    document.getElementById("verifyForm").addEventListener("submit", async (event) => {
        event.preventDefault();

        const wallet_address = document.getElementById("wallet_address").value;
        const token_id = document.getElementById("token_id").value;

        const body = {};
        if (token_id !== "") body.token_id = parseInt(token_id);
        else if (wallet_address) body.wallet_address = wallet_address;
        else { document.getElementById("verifyResult").innerText = "Enter a wallet address or token ID."; return; }

        const response = await fetch("/get_credit_report", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        const result = await response.json();
        const el = document.getElementById("verifyResult");

        if (result.error) {
            el.innerText = result.error;
            return;
        }

        if (result.snapshots) {
            if (result.snapshots.length === 0) {
                el.innerText = "No snapshots found for this wallet.";
                return;
            }
            el.innerHTML = result.snapshots.map(s =>
                `<div class="snapshot">
                    <strong>Token #${s.token_id}</strong><br>
                    Credit Score: ${s.credit_score}<br>
                    Timestamp: ${new Date(s.timestamp * 1000).toLocaleString()}
                </div>`
            ).join("<hr>");
        } else {
            el.innerHTML = `
                <div class="snapshot">
                    <strong>Token #${result.token_id}</strong><br>
                    Owner: ${result.owner}<br>
                    Credit Score: ${result.credit_score}<br>
                    Timestamp: ${new Date(result.timestamp * 1000).toLocaleString()}
                </div>`;
        }
    });
    </script>

</body>
</html>
